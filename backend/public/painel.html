<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel de Pedidos - Mickey Lanches</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="max-w-5xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">üì¶ Painel de Pedidos</h1>
    <div id="orders" class="space-y-4"></div>
  </div>

  <script>
    async function carregarPedidos() {
      const res = await fetch("/api/pedidos");
      const pedidos = await res.json();
      const div = document.getElementById("orders");
      div.innerHTML = pedidos.map(p => `
        <div class="bg-white p-4 rounded shadow">
          <p><b>Cliente:</b> ${p.customer_name} (${p.customer_phone})</p>
          <p><b>Tipo:</b> ${p.delivery_type}</p>
          <p><b>Pagamento:</b> ${p.payment_method}</p>
          <p><b>Total:</b> R$ ${p.total.toFixed(2)}</p>
          <p><b>Status:</b> <span class="text-blue-600">${p.status}</span></p>
          <p><b>Itens:</b><br>${JSON.parse(p.items).map(i => `- ${i.name} x${i.quantity}`).join("<br>")}</p>
          <div class="flex gap-2 mt-3">
            <button onclick="mudarStatus(${p.id}, 'em preparo')" class="bg-yellow-400 px-2 py-1 rounded">Em preparo</button>
            <button onclick="mudarStatus(${p.id}, 'entregue')" class="bg-green-500 px-2 py-1 rounded text-white">Entregue</button>
            <button onclick="imprimir(${p.id})" class="bg-gray-300 px-2 py-1 rounded">üñ®Ô∏è Imprimir</button>
          </div>
        </div>
      `).join("");
    }

    async function mudarStatus(id, status) {
      await fetch(`/api/pedidos/${id}/status`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ status })
      });
      carregarPedidos();
    }

    function imprimir(id) {
      const pedido = document.querySelector(`#orders div:nth-child(${id})`).innerHTML;
      const w = window.open("", "_blank");
      w.document.write(`<pre>${pedido}</pre>`);
      w.print();
      w.close();
    }

    carregarPedidos();
    setInterval(carregarPedidos, 5000); // atualiza a cada 5s
  </script>
</body>
</html>
